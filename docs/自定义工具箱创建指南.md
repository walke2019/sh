# 自定义工具箱创建指南

## 📋 项目概述

本项目基于 [kejilion/sh](https://github.com/kejilion/sh) 上游项目，是一个 Linux Shell 脚本工具箱。为了在保持上游更新的同时添加自己的自定义功能，需要创建独立的自定义工具箱目录。

---

## 🗂️ 推荐目录结构

```
f:\项目\sh\
├── kejilion.sh              # 上游主脚本（不修改）
├── custom/                  # 自定义工具箱目录（新建）
│   ├── custom_main.sh       # 自定义工具箱主入口
│   ├── tools/               # 自定义工具脚本目录
│   │   ├── tool1.sh
│   │   ├── tool2.sh
│   │   └── ...
│   ├── config/              # 自定义配置文件目录
│   │   ├── settings.conf
│   │   └── env.conf
│   └── README.md            # 自定义工具箱说明文档
├── docs/                    # 项目文档目录
│   └── 自定义工具箱创建指南.md
└── .gitignore               # Git 忽略配置
```

---

## 🚀 创建步骤

### 1. 创建自定义工具箱目录

```powershell
# 在项目根目录下创建 custom 目录
New-Item -Path "f:\项目\sh\custom" -ItemType Directory -Force
New-Item -Path "f:\项目\sh\custom\tools" -ItemType Directory -Force
New-Item -Path "f:\项目\sh\custom\config" -ItemType Directory -Force
```

### 2. 创建自定义工具箱主入口脚本

创建 `custom/custom_main.sh` 文件，作为自定义工具箱的主菜单：

```bash
#!/bin/bash
# 自定义工具箱主入口
# 版本: 1.0.0

# 颜色定义（与上游保持一致）
gl_hui='\e[37m'
gl_hong='\033[31m'
gl_lv='\033[32m'
gl_huang='\033[33m'
gl_lan='\033[34m'
gl_bai='\033[0m'
gl_zi='\033[35m'
gl_kjlan='\033[96m'

# 获取脚本所在目录
CUSTOM_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TOOLS_DIR="${CUSTOM_DIR}/tools"
CONFIG_DIR="${CUSTOM_DIR}/config"

# 加载配置文件
load_config() {
    if [ -f "${CONFIG_DIR}/settings.conf" ]; then
        source "${CONFIG_DIR}/settings.conf"
    fi
}

# 自定义工具箱主菜单
custom_toolbox_menu() {
    while true; do
        clear
        echo -e "${gl_kjlan}"
        echo "╔═══════════════════════════════╗"
        echo "║    自定义工具箱 v1.0.0        ║"
        echo "╚═══════════════════════════════╝"
        echo -e "${gl_bai}"
        echo -e "${gl_kjlan}------------------------${gl_bai}"
        echo -e "${gl_kjlan}1.   ${gl_bai}自定义工具 1"
        echo -e "${gl_kjlan}2.   ${gl_bai}自定义工具 2"
        echo -e "${gl_kjlan}3.   ${gl_bai}自定义工具 3"
        echo -e "${gl_kjlan}4.   ${gl_bai}配置管理"
        echo -e "${gl_kjlan}------------------------${gl_bai}"
        echo -e "${gl_kjlan}0.   ${gl_bai}返回上级菜单"
        echo -e "${gl_kjlan}------------------------${gl_bai}"
        read -e -p "请输入你的选择: " choice

        case $choice in
            1)
                if [ -f "${TOOLS_DIR}/tool1.sh" ]; then
                    bash "${TOOLS_DIR}/tool1.sh"
                else
                    echo -e "${gl_hong}工具脚本不存在！${gl_bai}"
                    sleep 2
                fi
                ;;
            2)
                if [ -f "${TOOLS_DIR}/tool2.sh" ]; then
                    bash "${TOOLS_DIR}/tool2.sh"
                else
                    echo -e "${gl_hong}工具脚本不存在！${gl_bai}"
                    sleep 2
                fi
                ;;
            3)
                if [ -f "${TOOLS_DIR}/tool3.sh" ]; then
                    bash "${TOOLS_DIR}/tool3.sh"
                else
                    echo -e "${gl_hong}工具脚本不存在！${gl_bai}"
                    sleep 2
                fi
                ;;
            4)
                config_menu
                ;;
            0)
                break
                ;;
            *)
                echo -e "${gl_hong}无效的输入！${gl_bai}"
                sleep 1
                ;;
        esac
    done
}

# 配置管理菜单
config_menu() {
    clear
    echo -e "${gl_kjlan}配置管理${gl_bai}"
    echo "功能开发中..."
    sleep 2
}

# 加载配置并启动主菜单
load_config
custom_toolbox_menu
```

### 3. 创建示例工具脚本

创建 `custom/tools/tool1.sh` 示例：

```bash
#!/bin/bash
# 自定义工具 1 - 示例脚本

echo "================================"
echo "    自定义工具 1 - 示例功能"
echo "================================"
echo ""
echo "这是一个示例工具脚本"
echo "你可以在这里添加自己的功能代码"
echo ""

# 示例功能：显示系统信息
echo "当前系统信息："
uname -a
echo ""

read -p "按回车键返回..." 
```

### 4. 创建配置文件

创建 `custom/config/settings.conf`：

```bash
# 自定义工具箱配置文件

# 工具箱版本
CUSTOM_VERSION="1.0.0"

# 自定义配置项
CUSTOM_SETTING_1="value1"
CUSTOM_SETTING_2="value2"

# 环境变量配置
# export CUSTOM_VAR="custom_value"
```

### 5. 创建自定义工具箱说明文档

创建 `custom/README.md`：

```markdown
# 自定义工具箱

## 简介

这是基于 kejilion.sh 上游项目的自定义工具箱扩展。

## 使用方法

### 启动自定义工具箱

```bash
bash custom/custom_main.sh
```

### 添加新工具

1. 在 `custom/tools/` 目录下创建新的 `.sh` 脚本
2. 在 `custom_main.sh` 中添加菜单项
3. 赋予脚本执行权限：`chmod +x custom/tools/your_tool.sh`

## 目录结构

- `custom_main.sh` - 主入口脚本
- `tools/` - 工具脚本目录
- `config/` - 配置文件目录

## 注意事项

- 不要修改上游 `kejilion.sh` 文件
- 所有自定义功能放在 `custom/` 目录下
- 定期同步上游更新
```

---

## 🔗 集成到主脚本（可选）

如果想在主脚本菜单中添加自定义工具箱入口，可以创建一个补丁脚本：

创建 `custom/integrate.sh`：

```bash
#!/bin/bash
# 将自定义工具箱集成到主脚本的辅助脚本

echo "集成自定义工具箱到主菜单..."

# 检查是否已经集成
if grep -q "自定义工具箱" ~/kejilion.sh 2>/dev/null; then
    echo "自定义工具箱已经集成！"
    exit 0
fi

# 备份原始脚本
cp ~/kejilion.sh ~/kejilion.sh.backup

# 在主菜单中添加自定义工具箱选项
# 注意：这需要根据实际的 kejilion.sh 版本调整
echo "请手动在 kejilion.sh 主菜单中添加以下内容："
echo ""
echo "在菜单显示部分添加："
echo 'echo -e "${gl_kjlan}16.  ${gl_bai}自定义工具箱"'
echo ""
echo "在 case 语句中添加："
echo '16) bash custom/custom_main.sh ;;'
```

---

## 📝 Git 版本控制配置

### 更新 .gitignore

创建或更新 `.gitignore` 文件：

```gitignore
# 上游文件（不提交）
kejilion.sh
kejilion_sh_log.txt
*.backup

# 保留自定义目录
!custom/

# 配置文件中的敏感信息
custom/config/*.key
custom/config/*.secret

# 临时文件
*.tmp
*.log
```

### Git 分支策略

建议使用以下分支策略：

```bash
# 主分支：跟踪上游
git checkout -b upstream

# 自定义分支：开发自己的功能
git checkout -b custom-dev

# 定期同步上游
git remote add upstream https://github.com/kejilion/sh.git
git fetch upstream
git merge upstream/main
```

---

## 🔄 更新维护流程

### 同步上游更新

```bash
# 1. 拉取上游最新代码
git fetch upstream
git checkout upstream
git merge upstream/main

# 2. 合并到自定义分支
git checkout custom-dev
git merge upstream

# 3. 解决冲突（如果有）
# 由于自定义功能在 custom/ 目录下，通常不会有冲突
```

### 添加新工具

```bash
# 1. 创建新工具脚本
cd custom/tools
nano my_new_tool.sh

# 2. 赋予执行权限
chmod +x my_new_tool.sh

# 3. 在 custom_main.sh 中添加菜单项

# 4. 测试功能
bash custom/custom_main.sh

# 5. 提交更改
git add custom/
git commit -m "添加新工具: my_new_tool"
```

---

## ⚠️ 注意事项

1. **不要修改上游文件**：所有自定义功能应放在 `custom/` 目录下
2. **配置文件管理**：敏感配置使用环境变量或独立配置文件
3. **脚本权限**：确保所有 `.sh` 文件有执行权限
4. **路径引用**：使用绝对路径或相对于脚本的路径
5. **定期备份**：重要配置和数据定期备份
6. **测试环境**：新功能先在测试环境验证

---

## 📚 扩展建议

### 工具分类

可以按功能对工具进行分类：

```
custom/tools/
├── system/          # 系统管理工具
├── network/         # 网络工具
├── docker/          # Docker 相关工具
├── database/        # 数据库工具
└── monitoring/      # 监控工具
```

### 配置模板

为不同环境创建配置模板：

```
custom/config/
├── settings.conf           # 主配置
├── settings.dev.conf       # 开发环境
├── settings.prod.conf      # 生产环境
└── settings.template.conf  # 配置模板
```

---

## 🆘 常见问题

### Q: 如何快速启动自定义工具箱？

A: 可以创建别名或快捷命令：

```bash
# 在 ~/.bashrc 中添加
alias ctool='bash /path/to/custom/custom_main.sh'

# 或创建软链接
ln -s /path/to/custom/custom_main.sh /usr/local/bin/ctool
```

### Q: 如何在工具脚本中使用上游的函数？

A: 可以在自定义脚本中 source 上游脚本：

```bash
# 在自定义脚本开头
source ~/kejilion.sh
# 然后就可以使用上游定义的函数和变量
```

### Q: 更新上游后自定义功能失效怎么办？

A: 由于自定义功能独立在 `custom/` 目录，通常不会受影响。如果有问题，检查：
1. 路径引用是否正确
2. 依赖的上游函数是否有变化
3. 配置文件是否需要更新

---

## 📞 技术支持

- 上游项目：https://github.com/kejilion/sh
- 自定义工具箱问题：请在项目 Issues 中提出

---

**最后更新时间**: 2025-01-25
