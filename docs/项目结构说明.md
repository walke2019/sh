# 项目结构说明

## 📁 完整目录结构

```
f:\项目\sh\
│
├── kejilion.sh                      # 上游主脚本（不修改）
├── kejilion_sh_log.txt              # 上游日志文件
├── LICENSE                          # 许可证文件
├── README.md                        # 上游项目说明
│
├── custom/                          # 🎯 自定义工具箱目录（核心）
│   ├── custom_main.sh               # 自定义工具箱主入口
│   ├── integrate.sh                 # 集成向导脚本
│   ├── README.md                    # 自定义工具箱说明
│   ├── 快速开始.md                  # 快速开始指南
│   │
│   ├── tools/                       # 自定义工具脚本目录
│   │   ├── tool1.sh                 # 示例工具 1
│   │   ├── tool2.sh                 # 示例工具 2
│   │   └── tool3.sh                 # 示例工具 3
│   │
│   └── config/                      # 配置文件目录
│       └── settings.conf            # 主配置文件
│
├── docs/                            # 📚 项目文档目录
│   ├── 自定义工具箱创建指南.md      # 详细创建指南
│   └── 项目结构说明.md              # 本文档
│
├── .gitignore                       # Git 忽略配置
│
└── [其他上游文件]                   # 上游项目的其他文件
    ├── cn/                          # 中文版本
    ├── en/                          # 英文版本
    ├── ir/                          # 波斯语版本
    ├── jp/                          # 日语版本
    ├── kr/                          # 韩语版本
    ├── ru/                          # 俄语版本
    ├── tw/                          # 繁体中文版本
    └── ...                          # 其他配置和脚本文件
```

---

## 🎯 核心目录说明

### 1. custom/ - 自定义工具箱目录

这是你的**核心工作目录**，所有自定义功能都应该放在这里。

#### 主要文件：

- **custom_main.sh**：自定义工具箱的主入口脚本，包含菜单系统
- **integrate.sh**：集成向导，帮助将自定义工具箱集成到主脚本
- **README.md**：自定义工具箱的使用说明
- **快速开始.md**：快速上手指南

#### 子目录：

- **tools/**：存放所有自定义工具脚本
  - 每个工具一个独立的 `.sh` 文件
  - 建议按功能分类组织
  
- **config/**：存放配置文件
  - `settings.conf`：主配置文件
  - 可以添加更多环境相关的配置文件

### 2. docs/ - 文档目录

存放项目相关的中文文档：

- **自定义工具箱创建指南.md**：详细的创建和使用指南
- **项目结构说明.md**：本文档，说明项目结构

### 3. 上游文件

这些是从 kejilion/sh 项目继承的文件，**不应该直接修改**：

- `kejilion.sh`：上游主脚本
- 多语言目录（cn/, en/, ir/, jp/, kr/, ru/, tw/）
- 其他配置文件和工具脚本

---

## 🔄 工作流程

### 开发流程

```
1. 在 custom/tools/ 创建新工具脚本
   ↓
2. 在 custom_main.sh 添加菜单项
   ↓
3. 测试工具功能
   ↓
4. 更新文档
   ↓
5. 提交到 Git
```

### 更新流程

```
1. 拉取上游更新
   ↓
2. 检查是否影响自定义功能
   ↓
3. 必要时调整自定义代码
   ↓
4. 测试所有功能
   ↓
5. 提交更改
```

---

## 📋 文件命名规范

### Shell 脚本

- 使用小写字母和下划线
- 扩展名为 `.sh`
- 示例：`my_custom_tool.sh`

### 配置文件

- 使用小写字母和下划线
- 扩展名为 `.conf` 或 `.cfg`
- 示例：`database.conf`

### 文档文件

- 使用中文命名
- 扩展名为 `.md`
- 示例：`使用说明.md`

---

## 🎨 目录组织建议

### 按功能分类（推荐）

```
custom/tools/
├── system/              # 系统管理工具
│   ├── info.sh
│   ├── monitor.sh
│   └── cleanup.sh
├── network/             # 网络工具
│   ├── speed_test.sh
│   └── port_scan.sh
├── docker/              # Docker 工具
│   ├── container_mgr.sh
│   └── image_mgr.sh
└── database/            # 数据库工具
    ├── backup.sh
    └── restore.sh
```

### 按项目分类

```
custom/tools/
├── project_a/           # 项目 A 相关工具
│   ├── deploy.sh
│   └── monitor.sh
├── project_b/           # 项目 B 相关工具
│   ├── backup.sh
│   └── sync.sh
└── common/              # 通用工具
    ├── utils.sh
    └── helpers.sh
```

---

## 🔒 安全建议

### 敏感信息管理

1. **不要在脚本中硬编码敏感信息**
   - 使用配置文件
   - 使用环境变量
   - 使用密钥管理工具

2. **配置文件权限**
   ```bash
   chmod 600 custom/config/secrets.conf
   ```

3. **Git 忽略敏感文件**
   ```gitignore
   custom/config/*.key
   custom/config/*.secret
   custom/config/*.env
   ```

### 脚本安全

1. **输入验证**
   ```bash
   if [[ ! "$input" =~ ^[a-zA-Z0-9]+$ ]]; then
       echo "无效输入"
       exit 1
   fi
   ```

2. **使用引号**
   ```bash
   # 好的做法
   rm -rf "${backup_dir}"
   
   # 不好的做法（可能导致意外删除）
   rm -rf $backup_dir
   ```

3. **错误处理**
   ```bash
   set -e  # 遇到错误立即退出
   set -u  # 使用未定义变量时报错
   ```

---

## 📊 版本控制策略

### Git 分支管理

```
main            # 主分支，跟踪上游
├── upstream    # 上游同步分支
└── custom      # 自定义开发分支
    ├── feature/tool-a    # 功能分支
    └── feature/tool-b    # 功能分支
```

### 提交规范

```bash
# 功能添加
git commit -m "feat: 添加系统监控工具"

# 功能修复
git commit -m "fix: 修复配置文件加载问题"

# 文档更新
git commit -m "docs: 更新使用说明"

# 配置调整
git commit -m "config: 更新数据库配置"
```

---

## 🔧 开发工具推荐

### 编辑器

- **VSCode**：推荐安装 ShellCheck 扩展
- **Vim/Neovim**：轻量级，适合服务器端编辑
- **Sublime Text**：快速响应

### 调试工具

- **shellcheck**：Shell 脚本静态分析工具
  ```bash
  shellcheck custom/tools/my_tool.sh
  ```

- **bash -x**：调试模式
  ```bash
  bash -x custom/tools/my_tool.sh
  ```

### 测试工具

- **bats**：Bash 自动化测试系统
- **shunit2**：Shell 单元测试框架

---

## 📈 扩展方向

### 1. 添加日志系统

```bash
# custom/tools/logger.sh
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "${LOG_DIR}/toolbox.log"
}
```

### 2. 添加错误处理

```bash
# custom/tools/error_handler.sh
handle_error() {
    echo "错误：$1"
    log "ERROR: $1"
    exit 1
}
```

### 3. 添加通知系统

```bash
# custom/tools/notify.sh
send_notification() {
    # 发送邮件、Telegram 消息等
    echo "$1" | mail -s "工具箱通知" user@example.com
}
```

### 4. 添加定时任务

```bash
# 使用 cron 定时执行工具
0 2 * * * bash /path/to/custom/tools/backup.sh
```

---

## 📞 获取帮助

- **上游项目**：https://github.com/kejilion/sh
- **文档位置**：`docs/` 目录
- **示例代码**：`custom/tools/` 目录

---

**最后更新**: 2025-01-25
